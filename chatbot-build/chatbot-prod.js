(()=>{const e="https://chatbot.gtwy.ai/chatbot";let t=null,n=!1,o=!1;const i="interfaceData";let a={};function d(e){return`https://imagedelivery.net/Vv7GgOGQbSyClWJqhyP0VQ/${e}/public`}const c=d("b1357e23-2fc6-4dc3-855a-7a213b1fa100"),s=d("91ee0bff-cfe3-4e2d-64e5-fadbd9a3a200");let r=document.getElementById("chatbot-main-script");const l=document.createElement("div");l.id="interfaceEmbed";const m=document.createElement("img");m.id="popup-interfaceEmbed",m.className="chatbot-icon-interfaceEmbed",m.alt="Ask Ai",m.src=s,m.style.visibility="hidden",l.appendChild(m);const p=document.createElement("span");p.id="popup-interfaceEmbed-text",l.appendChild(p),document.body.appendChild(l);var f=document.createElement("link");f.id="chatbotEmbed-style",f.rel="stylesheet",f.type="text/css",f.href="https://chatbot-embed.viasocket.com/style-prod.css",document.head.appendChild(f);const u=(e={})=>{a={...a,...e},y(e)},y=e=>{e.iconColor&&(document.getElementById("popup-interfaceEmbed").src="dark"===e.iconColor?c:s),!0!==e.fullScreen&&"true"!==e.fullScreen||document.getElementById("iframe-parent-container")?.classList.add("full-screen-interfaceEmbed"),!1!==e.fullScreen&&"false"!==e.fullScreen||document.getElementById("iframe-parent-container")?.classList.remove("full-screen-interfaceEmbed"),"hideIcon"in e&&document.getElementById("interfaceEmbed")&&(document.getElementById("interfaceEmbed").style.display=!0===e.hideIcon||"true"===e.hideIcon?"none":"unset"),"hideCloseButton"in e&&document.getElementById("close-button-interfaceEmbed")&&(document.getElementById("close-button-interfaceEmbed").style.display=!0===e.hideCloseButton||"true"===e.hideCloseButton?"none":"unset")};function h(){r?["interfaceId","embedToken","threadId","bridgeName","variables","onOpen","onClose","iconColor","className","style","environment","fullScreen","hideCloseButton","hideIcon","parentId","config","headerButtons","eventsToSubscribe","modalConfig","allowModalSwitch"].forEach((e=>{if(r.hasAttribute(e)){let n=r.getAttribute(e);if(("config"===e||"headerButtons"===e||"eventsToSubscribe"===e||"modalConfig"===e)&&n)try{n=JSON.parse(n)}catch(e){console.log(e)}a[e]=n,t={...t,[e]:n}}})):console.log("Script tag not found")}h(),new MutationObserver((function(e,t){for(const n of e)if("childList"===n.type){for(const e of n.addedNodes)"chatbot-main-script"===e.id&&(r=document.getElementById("chatbot-main-script"),h());for(const e of n.removedNodes)if("chatbot-main-script"===e.id){console.log("Script tag removed, performing cleanup...");const e=document.getElementById("iframe-parent-container"),n=document.getElementById("interfaceEmbed"),o=document.getElementById("chatbotEmbed-style");n&&n.remove(),e&&e.remove(),o&&o.remove(),t.disconnect()}}})).observe(document.head,{childList:!0}),new ResizeObserver((e=>{const t=document.getElementById("iframe-parent-container");for(let n of e){const{width:e,height:i}=n.contentRect;if(o)return;e<600?t&&(t.style.height="100%",t.style.width="100%"):t&&C(a?.config)}})).observe(document.documentElement),closeChatbot=function(){const e=document.getElementById("iframe-parent-container");if("block"===e?.style?.display)return e.style.transition="opacity 0.2s ease-in-out",e.style.opacity=0,void setTimeout((()=>{e.style.display="none",document.body.style.overflow="auto",document.getElementById("interfaceEmbed")&&(document.getElementById("interfaceEmbed").style.display=!0===a.hideIcon||"true"===a.hideIcon?"none":"unset"),window.parent?.postMessage({type:"close",data:{}},"*"),window.ReactNativeWebView&&window?.ReactNativeWebView?.postMessage(JSON.stringify({type:"close",data:{}})),N.contentWindow?.postMessage({type:"close",data:{}},"*")}),200)};const b=setTimeout((()=>{window.removeEventListener("message",g),console.log("Event listener removed after 60 seconds")}),6e4);function g(e){const{type:n}=e.data;"interfaceLoaded"===n&&(t&&document.getElementById("iframe-component-interfaceEmbed").contentWindow&&(document.getElementById("iframe-component-interfaceEmbed").contentWindow.postMessage({type:i,data:t},"*"),t=null),window.removeEventListener("message",g),clearTimeout(b))}let E=null,w={type:"popup",height:"100",heightUnit:"%",width:"50",widthUnit:"%",buttonName:""},I="Via socket",v="Chatbot",B="popup";function C(e){const t=document.getElementById("interfaceEmbed"),n=document.getElementById("iframe-parent-container");n&&(e&&(e.title&&(I=e.title),e.buttonName?(v=e.buttonName,p.innerText=v,t.classList.add("show-bg-color"),m&&(m.style.visibility="hidden")):(p.innerText="",t?.classList.remove("show-bg-color"),m&&(m.style.visibility="visible")),e.iconUrl&&(m&&(m.src=e.iconUrl),t?.classList.remove("show-bg-color"),p.innerText="",m&&(m.style.visibility="visible")),e.type&&n&&(n?.classList.forEach((e=>{e.endsWith("-parent-container")&&n.classList.remove(e)})),t?.classList.forEach((e=>{e.endsWith("-interfaceEmbed")&&t.classList.remove(e)})),n?.classList.add(`${e.type}-parent-container`),t?.classList.add(`${e.type}-interfaceEmbed`),B=e.type)),"all_available_space"===B?(n.style.height="100%",n.style.width="100%",n.style.display="block"):(n.style.height=`${e?.height}${e?.heightUnit||""}`||"70vh",n.style.width=`${e?.width}${e?.widthUnit||""}`||"40vw"))}loadChatbotEmbed=async function(){const t=document.getElementById("chatbot-main-script")?.getAttribute("embedToken");let n=`${e}?`,o={};if(t)o={method:"POST",headers:{"Content-Type":"application/json",Authorization:t}};else{const e=document.getElementById("chatbot-main-script")?.getAttribute("interface_id");e&&(o={method:"POST",body:JSON.stringify({isAnonymousUser:!0,interface_id:e}),headers:{"Content-Type":"application/json"}})}fetch("https://db.gtwy.ai/chatbot/loginuser",o).then((async e=>await e.json())).then((t=>{if(!document.getElementById("iframe-parent-container"))return;w=t?.data?.config;const o=encodeURIComponent(`${JSON.stringify(t.data)}`);n=n.concat(`interfaceDetails=${o}`);const i=document.getElementById("iframe-component-interfaceEmbed")?.src?.split("?"),d=i?.[0];d!==e&&document.getElementById("iframe-component-interfaceEmbed")&&(document.getElementById("iframe-component-interfaceEmbed").src=n),w&&(a.config={...a?.config,...w},C({...w}))})).catch((e=>{console.log("Fetch error:",e)}))};const S=function(e=a.parentId||"",t=n){t||(window.addEventListener("message",g),E||(E=document.createElement("div"),E.id="iframe-parent-container",E.className="popup-parent-container",E.style.display="none",E.innerHTML='\n        <iframe id="iframe-component-interfaceEmbed" title="iframe" sandbox="allow-scripts allow-same-origin allow-popups"></iframe>\n      '),L(e),n=!0,u({...a}),loadChatbotEmbed())},L=function(e){if(window.addEventListener("message",g),e&&document.getElementById(e)){const t=document.getElementById(e);t&&(t.style.position="relative",t.appendChild(E))}else document.getElementById("interface-chatbot")?document.getElementById("interface-chatbot").appendChild(E):document.body.appendChild(E)};document.addEventListener("DOMContentLoaded",S),document?.body&&S();const N=document.getElementById("iframe-component-interfaceEmbed");N?.contentWindow&&(N.onload=function(){try{N.contentWindow?.postMessage({type:i,data:t},"*")}catch(e){console.error("Error serializing data:",e)}}),SendDataToChatbot=function(e){if("string"==typeof e&&(e=JSON.parse(e)),window.ReactNativeWebView&&window?.ReactNativeWebView?.postMessage(JSON.stringify({type:"data",data:e})),"parentId"in e){t={...t,...e};var n=a.parentId,o=document.getElementById(n);o?.contains(E)?n!==e.parentId&&(n?o&&E&&o.contains(E)&&o.removeChild(E):E&&document.body.contains(E)&&document.body.removeChild(E),u({parentId:e.parentId}),L(e?.parentId||"")):(u({parentId:e.parentId}),L(e?.parentId||""))}T(e)};const T=e=>{if("hideCloseButton"in e&&u({hideCloseButton:e.hideCloseButton||!1}),"hideIcon"in e&&u({hideIcon:e.hideIcon||!1}),e.iconColor&&u({iconColor:e.iconColor||"dark"}),!0!==e.fullScreen&&"true"!==e.fullScreen||u({fullScreen:e.fullScreen}),!1!==e.fullScreen&&"false"!==e.fullScreen||u({fullScreen:e.fullScreen}),e&&N?.contentWindow&&(t={...t,...e},N.contentWindow?.postMessage({type:i,data:e},"*")),e.askAi&&N?.contentWindow&&N.contentWindow?.postMessage({type:"askAi",data:e||{}},"*"),"config"in e){var n={...w,...e?.config};C(n),u({config:n})}};openChatbot=function(){if(window.parent?.postMessage({type:"open",data:{}},"*"),window.ReactNativeWebView&&window?.ReactNativeWebView?.postMessage(JSON.stringify({type:"open",data:{}})),N.contentWindow?.postMessage({type:"open",data:{}},"*"),document.getElementById("interfaceEmbed")&&document.getElementById("iframe-parent-container")){document.getElementById("interfaceEmbed").style.display="none";const e=document.getElementById("iframe-parent-container");e.style.display="block",e.style.opacity=0,e.style.transition="opacity 0.3s ease-in-out",requestAnimationFrame((()=>{e.style.opacity=1})),document.body.style.overflow="hidden"}},reloadChats=function(){N.contentWindow?.postMessage({type:"refresh",reload:!0},"*")},askAi=function(e){N.contentWindow?.postMessage({type:"askAi",data:e||""},"*")},document.getElementById("interfaceEmbed")?.addEventListener("click",(()=>{window.openChatbot()})),window.addEventListener("message",(e=>{if("CLOSE_CHATBOT"===e.data?.type)closeChatbot();else if("ENTER_FULL_SCREEN_CHATBOT"===e.data?.type){o=!0;const e=document.getElementById("iframe-parent-container");e.style.transition="width 0.3s ease-in-out, height 0.3s ease-in-out",e.style.width="100%",e.style.height="100%"}else if("EXIT_FULL_SCREEN_CHATBOT"===e.data?.type){o=!1;const e=document.getElementById("iframe-parent-container");e.style.transition="width 0.3s ease-in-out, height 0.3s ease-in-out",e.style.height=`${w?.height}${w?.heightUnit||""}`||"70vh",e.style.width=`${w?.width}${w?.widthUnit||""}`||"40vw"}}))})();